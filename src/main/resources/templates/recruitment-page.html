<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chi tiết Tuyển Dụng</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
    }
    h2 {
      color: #333;
    }
    p {
      margin: 5px 0;
    }
    .btn {
      display: inline-block;
      margin-top: 15px;
      padding: 10px 15px;
      text-decoration: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }
    .back-link {
      color: white;
      background-color: gray;
    }
    .apply-btn {
      color: white;
      background-color: blue;
    }
  </style>

  <div class="schedule__blog-item mb-30">
    <div class="schedule__content">
      <div class="schedule__blog-meta">
        <div class="news__meta-status">
          <span><i class="flaticon-user"></i></span>
          <span>Andru Hebo</span>
        </div>
        <div class="news__meta-status">
          <span><i class="flaticon-clock"></i></span>
          <span>9:00am- 5:00 pm</span>
        </div>
      </div>
      <h5 class="schedule__blog-title"><a href="event-list.html">Nasa Space Apps Challenge kicks off in Bangladesh</a></h5>
      <div class="schedule__blog-location">
        <div class="news__meta-status">
          <span><i class="flaticon-placeholder"></i></span>
          <span>California(CA), 92677</span>
        </div>
      </div>
    </div>
    <div class="schedule__blog-thumb w-img">
      <div class="schedule__tag-post">
        <div class="event__tag-item">
          <span><a href="event-details.html">Hall 03</a></span>
        </div>
        <div class="event__tag-item">
          <span><a href="event-details.html">10 Seat Available</a></span>
        </div>
      </div>
      <a href="event-details.html">
        <img src="assets/img/blog/schedule/01.jpg" alt="image not found">
      </a>
    </div>
  </div>



<script>
  function getIdsFromPath() {
    let pathSegments = window.location.pathname.split('/');
    let recruitmentId = pathSegments[pathSegments.length - 2];
    let userId = pathSegments[pathSegments.length - 1];

    return { recruitmentId, userId };
  }

  function applyJob() {
    let messageEl = document.getElementById("message");


    let {recruitmentId, userId} = getIdsFromPath();

    console.log("Recruitment ID:", recruitmentId, "User ID:", userId);

    if (!recruitmentId || !userId || isNaN(recruitmentId) || isNaN(userId)) {
      messageEl.textContent = "❌ Không tìm thấy thông tin tuyển dụng hoặc người dùng.";
      messageEl.style.color = "red";
      return;
    }

    fetch(`/file/user/${userId}`)
            .then(response => {
              if (!response.ok) {
                throw new Error("Không tìm thấy CV của bạn!");
              }
              return response.json();
            })
            .then(file => {
              console.log("Received file data:", file); // In ra dữ liệu file để kiểm tra
              if (!file.id) {
                throw new Error("CV không hợp lệ. Vui lòng tải lên CV trước khi apply!");
              }

              let cvSubmitter = {
                recruitmentId: recruitmentId,
                fileId: file.id
              };

              return fetch("/CVSubmitter/create", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(cvSubmitter)
              });
            })

            .then(response => {
              if (!response.ok) {
                throw new Error("Apply thất bại. Vui lòng thử lại!");
              }
              return response.json();
            })
            .then(data => {
              messageEl.textContent = "✅ Apply thành công!";
              messageEl.style.color = "green";
            })
            .catch(error => {
              messageEl.textContent = "❌ " + error.message;
              messageEl.style.color = "red";
            });
  }

</script>

</body>
</html>
